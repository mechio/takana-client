(function(){var d=function(){};d.prototype={bind:function(c,a){this._events=this._events||{};this._events[c]=this._events[c]||[];this._events[c].push(a)},unbind:function(c,a){this._events=this._events||{};if(!1!==c in this._events){var b=this._events[c].indexOf(a);-1!==b?this._events[c].splice(b,1):this._events[c]=[]}},trigger:function(c){this._events=this._events||{};if(!1!==c in this._events)for(var a=0;a<this._events[c].length;a++)this._events[c][a].apply(this,Array.prototype.slice.call(arguments,
1))}};d.mixin=function(c){for(var a=["bind","unbind","trigger"],b=0;b<a.length;b++)"function"===typeof c?c.prototype[a[b]]=d.prototype[a[b]]:c[a[b]]=d.prototype[a[b]]};"undefined"!==typeof module&&"exports"in module&&(module.exports=d);"undefined"!==typeof define&&define([],function(){return d});window.Takana={};Takana.Config=function(){return function(){}}();Takana.Project=function(){return function(c){this.name=c.name;this.documentStyleSheets=[];this.styleSheets={};StyleSheetList.prototype.forEach=
Array.prototype.forEach;document.styleSheets.forEach(function(a){return function(b){if(b.href&&(b.href.match(/^http\:\/\/.*\.css.*/)||b.href.match(/^file\:\/\/.*/)))return a.documentStyleSheets.push(b)}}(this));Takana.Server.instance.bind("stylesheet:resolved",function(a){return function(b){return a.documentStyleSheets.forEach(function(c){if(b.href===c.href)return c=new Takana.StyleSheet({documentStyleSheet:c,id:b.id}),a.styleSheets[b.id]=c,c.startListening()})}}(this));this.documentStyleSheets.forEach(function(a){return function(b){return Takana.Server.instance.send("stylesheet:resolve",
{href:b.href})}}(this))}}();Takana.Server=function(){function c(a,b){this.projectName=a.projectName;this.url="ws://"+Takana.Config.hostname+":"+Takana.Config.port+"/browser?projectName="+this.projectName;this.socket=new WebSocket(this.url);this.socket.onopen=b;this.socket.onmessage=function(b){return function(a){a=JSON.parse(a.data);return b.trigger(a.event,a.data)}}(this)}c.prototype.send=function(a,b){if(this.socket.readyState===WebSocket.OPEN)return this.socket.send(JSON.stringify({event:a,data:b}))};
return c}();d.mixin(Takana.Server);Takana.StyleSheet=function(){function c(a){this.documentStyleSheet=a.documentStyleSheet;this.el=this.documentStyleSheet.ownerNode;this.href=this.documentStyleSheet.href;this.id=a.id}c.prototype.startListening=function(){Takana.Server.instance.send("stylesheet:listen",{id:this.id});return Takana.Server.instance.bind("stylesheet:updated",function(a){return function(b){if(b.id===a.id)return a.update(b.url)}}(this))};c.prototype.onceCSSIsLoaded=function(a,b){var c,d;
c=!1;d=function(a){return function(){var a;if(!c)return clearInterval(null),c=!0,a=/AppleWebKit/.test(navigator.userAgent)?5:100,setTimeout(b,a)}}(this);a.onload=function(a){return function(){return d()}}(this);return setTimeout(d,15E3)};c.prototype.update=function(a){var b;a="http://"+Takana.Config.hostname+":"+Takana.Config.port+"/"+a+"?"+Date.now()+"&href="+encodeURIComponent(this.href);b=document.createElement("link");b.setAttribute("type","text/css");b.setAttribute("href",a);b.setAttribute("media",
"all");b.setAttribute("rel","stylesheet");document.getElementsByTagName("body")[0].insertBefore(b,this.el);return this.onceCSSIsLoaded(b,function(a){return function(){a.el.remove();return a.el=b}}(this))};return c}();Takana.Client=function(){function c(){var a,b;this.scriptTag=document.querySelectorAll("script[data-project]")[0];this.projectName=this.scriptTag.getAttribute("data-project");Takana.Config.port=48626;Takana.Config.hostname=(b=this.scriptTag.getAttribute("src"))?(a=document.createElement("a"),
a.href=b,a.hostname):"localhost";Takana.Server.instance=this.server=new Takana.Server({projectName:this.projectName},function(a){return function(){return a.project=new Takana.Project({name:a.projectName})}}(this))}c.start=function(){return new Takana.Client};return c}();__karma__||(window.takana=Takana.Client.start())})();
